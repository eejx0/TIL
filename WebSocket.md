# μ›Ή μ†μΌ“ (Web Socket)
### π—£Β μ›Ή μ†μΌ“ (Web Socket)

---

> **μ›Ή μ•±κ³Ό μ„λ²„ κ°„μ μ§€μ†μ μΈ μ—°κ²°μ„ μ κ³µν•λ” ν”„λ΅ν† μ½** β…
> 

μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„μ μ–‘λ°©ν–¥ ν†µμ‹ μ΄ κ°€λ¥ν•΄μ§
WebSocket μ—°κ²°μ€ ν• λ² μ—΄λ¦° ν›„ κ³„μ† μ μ§€λλ―€λ΅ μ„λ²„λ‚ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ–Έμ λ“ μ§€ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•  μ μμ

β†’ **μ‹¤μ‹κ°„ ν†µμ‹ **μ—μ„ μ κ·Ή μ‚¬μ©

<aside>
π”¥

**μ‹¤μ‹κ°„ μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ„ν•΄ μ„¤κ³„λ ν†µμ‹  ν”„λ΅ν† μ½**

---

- TCPλ¥Ό κΈ°λ°μΌλ΅ ν•¨
- μ‹ λΆ°μ„± μλ” λ°μ΄ν„° μ „μ†΅μ„ λ³΄μ¥ν•κ³  λ©”μ‹μ§€ κ²½κ³„λ¥Ό μ΅΄μ¤‘
- μμ„κ°€ λ³΄μ¥λ μ–‘λ°©ν–¥ ν†µμ‹  μ κ³µ (μ–‘μ½μ—μ„ λ¨λ‘ μ •λ³΄λ¥Ό μ£Όκ³ λ°›μ„λ• λ°μ΄ν„°λ” ν¨ν‚· ν•νƒλ΅ μ „λ‹¬λκ³  μ „μ†΅μ€ μ—°κ²° μ¤‘λ‹¨κ³Ό μ¶”κ°€ HTTP μ”μ²­ μ—†μ΄ μ–‘λ°©ν–¥μΌλ΅ μ΄λ£¨μ–΄μ§)
</aside>

### π—£Β λ“±μ¥ λ°°κ²½

---

**μ΄κΈ°μ μΈν„°λ„· ν†µμ‹  λ°©μ‹**

- ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ”μ²­μ„ λ³΄λ‚΄κ³  μ„λ²„κ°€ μ΄μ— μ‘λ‹µ
- ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² μ”μ²­ν•μ§€ μ•λ” μ΄μƒ μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ—κ² λ¨Όμ € λ°μ΄ν„°λ¥Ό λ³΄λ‚Ό μ μ—†μ
- ν΄λΌμ΄μ–ΈνΈλ” ν•­μƒ μƒλ΅μ΄ λ°μ΄ν„°κ°€ μλ”μ§€ ν™•μΈ ν•κΈ° μ„ν•΄ μ„λ²„μ— μ§€μ†μ μΌλ΅ μ”μ²­μ„ λ³΄λ‚΄μ•Ό ν•¨
- λ¶ν•„μ”ν• νΈλν”½ β¬†οΈ
- μ„λ²„ λΉ„μ© β¬†οΈ
- μ”μ²­κ³Ό μ‘λ‹µ μ‚¬μ΄μ μ§€μ—°μ‹κ°„ λ•λ¬Έμ— μ‹¤μ‹κ°„ ν†µμ‹ μ ν¨μ¨μ„± β¬‡οΈ

β†’ μ΄λ° μƒν™©μ„ ν•΄κ²°ν•κΈ° μ„ν•΄ μ‚¬μ©ν•λ” κ²ƒμ΄ **`μ›Ή μ†μΌ“`**

### π—£Β μ—°κ²°ν•λ” λ°©μ‹

---

ν΄λΌμ΄μ–ΈνΈ ν™κ²½μ—μ„  λ³„λ„μ ν¨ν‚¤μ§€ μ„¤μΉ μ—†μ΄ λΈλΌμ°μ € μμ²΄μ—μ„ web Socket API μ§€μ› 

β†’ new μ›Ήμ†μΌ“λ§ νΈμ¶ν•΄ μ‚¬μ©ν•λ©΄λ¨ (ws λΌλ” νΉμ ν”„λ΅ν† μ½ μ‚¬μ©)

```tsx
const socket = new WebSocket("wss://example/chat");
```

μ†μΌ“ μ΄λ²¤νΈ

- **open**: μ—°κ²°μ΄ μ„±κ³µμ μΌλ΅ λμ—μ„ λ• λ°μƒ
- **message**: λ°μ΄ν„°λ¥Ό μμ‹ ν–μ„ λ• λ°μƒ
- **error**: μ—°κ²° μƒ μ—λ¬κ°€ μƒκ²Όμ„ λ• λ°μƒ
- **close**: μ—°κ²°μ΄ μΆ…λ£λμ—μ„ λ• λ°μƒ

```tsx
let socket = new WebSocket("wss://example/chat");
// μ΄λ ‡κ² μ†μΌ“μ„ μƒμ„±ν•λ©΄ μ¦‰μ‹ μ—°κ²°μ΄ μ‹μ‘λ¨

socket.onopen = function(e) {
	// [open] μ»¤λ„¥μ…μ΄ λ§λ“¤μ–΄μ§
	socket.send("μ•λ‡½") 
} 

socket.onmessage = function(event) {
	console.log(`${event.data}`); // [message] μ„λ²„λ΅λ¶€ν„° μ „μ†΅λ°›μ€ λ°μ΄ν„°κ°€ μ¶λ ¥λ¨
}

socket.onclose = function(event) {
	if (event.wasClean) {
		console.log(`code=${event.code} reason=${event.reason}`); // [close] μ»¤λ„¥μ… μΆ…λ£
	} else {
		console.log("[close] μ»¤λ„¥μ…μ΄ μ£½μ") // ex: ν”„λ΅μ„Έμ¤κ°€ μ£½κ±°λ‚ λ„¤νΈμ›ν¬μ— μ¥μ• κ°€ μλ” κ²½μ°
		// event.codeκ°€ 1006μ΄ λ¨
	}
}

socket.onerror = function(error) {
	alert(`[error]`)
}
```

### π—£Β handshake

---

`new WebSocket("wss://example/chat")` μ„ νΈμ¶ν•΄ μµμ΄ μ”μ²­μ„ μ „μ†΅ν•λ©΄ μ”μ²­ ν—¤λ”λ”

```
GET /chat
Host: example
Origin: https://example
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Key: Iv8io/9s+lYFgZWcXczP8Q==
Sec-WebSocket-Version: 13
```

**Origin**: ν΄λΌμ΄μ–ΈνΈμ Origin

**Connection**: ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ ν”„λ΅ν† μ½μ„ λ°”κΎΈκ³  μ‹¶λ‹¤λ” μ‹ νΈλ¥Ό λ³΄λƒλ‹¤λ” κ²ƒ

**Upgrade**: ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ μ”μ²­ν• ν”„λ΅ν† μ½μ€ websocketμ΄λΌλ”κ±Έ μλ―Έ

**Sec-WebSocket-Key**: λ³΄μ•μ„ μ„ν•΄ λΈλΌμ°μ €μ—μ„ μƒμ„±ν• ν‚¤

β†’ μ„λ²„κ°€ μ›Ήμ†μΌ“ ν”„λ΅ν† μ½μ„ μ§€μ›ν•λ”μ§€ ν™•μΈν•λ” λ° μ‚¬μ©λ¨

**Sec-WebSocket-Version**: μ›Ήμ†μΌ“ ν”„λ΅ν† μ½ λ²„μ „

μ„λ²„κ°€ ν•΄λ‹Ή μ”μ²­μ„ λ°›μΌλ©΄ μ›Ή μ†μΌ“ μ—°κ²°μ„ μλ½ν•λ” μ΄λ° μ‘λ‹µμ„ λ³΄λƒ„

```
101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: hsBYongNyong24s99EO10UlZ22C2g=
```

β†’ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„ μ‹¤μ‹κ°„ ν†µμ‹ μ΄ κ°€λ¥ν• ν†µλ΅κ°€ μ—΄λ¦Ό

β†’ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ— μ‹¤μ‹κ°„ μ–‘λ°©ν–¥ ν†µμ‹ μ΄ κ°€λ¥ν•΄μ§

### π—£Β ν•κ³„μ 

---

- μ›Ή μ†μΌ“μ€ HTML5 μ‚¬μ–‘μ μΌλ¶€λΌ HTML5λ¥Ό μ§€μ›ν•μ§€ μ•λ” λΈλΌμ°μ €μ—μ„  μ‚¬μ© β
- μ›Ή μ†μΌ“μ€ ν•λ² μ—°κ²°λλ©΄ λ³„λ„μ μ—λ¬, μ§€μ‹κ°€ μ—†λ” ν• μ§€μ†μ μΈ μ—°κ²°μ„ μ μ§€ν•λ―€λ΅ λ§μ€ μ›Ή μ†μΌ“ μ—°κ²°μ„ λ™μ‹μ— κ΄€λ¦¬ν•λ” κ²½μ° μ„λ²„μ λ¶€ν• β¬†οΈ
- μ—°κ²°μ΄ λμ–΄μ΅μ„ μ‹ μ›Ήμ†μΌ“μ€ μ—°κ²°μ΄ λκΈ΄ μ΄μ μ— λ€ν•΄ μ •ν™•ν μ• μ μ—†μΌλ―€λ΅ κ·Έμ— λ€ν• μ—λ¬ μ²λ¦¬λ„ μ‰½μ§€μ•μ
